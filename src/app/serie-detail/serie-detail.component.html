<div>
    @if (loading()) {
    <div class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p class="body-medium">{{ 'serie_detail.loading' | transloco }}</p>
    </div>
    }

    @else if (error()) {
    <div class="error-container">
        <mat-icon color="warn">error</mat-icon>
        <h2 class="headline-small">{{ 'serie_detail.error_title' | transloco }}</h2>
        <p class="body-medium">{{ error() }}</p>
        <button mat-stroked-button color="primary" (click)="goBack()"
            [attr.aria-label]="'serie_detail.go_back' | transloco">
            <mat-icon>arrow_back</mat-icon>
            {{ 'serie_detail.go_back' | transloco }}
        </button>
    </div>
    }

    @else if (serie()) {
    <div class="serie-detail-container">
        <app-serie-header [serie]="serie()!" [backdropUrl]="backdropUrl()" [posterUrl]="posterUrl()"
            [isAuthenticated]="isAuthenticated()" [isFollowing]="isFollowing()" [isWatched]="isWatched()"
            [followLoading]="followLoading()" [watchedLoading]="watchedLoading()" [formatRating]="formatRating"
            (goBack)="goBack()" (toggleFollow)="onToggleFollow()" (toggleWatched)="onToggleWatched()" />

        <div class="content-container">
            <mat-card class="overview-card">
                <mat-card-header>
                    <mat-card-title class="headline-small">{{ 'serie_detail.overview' | transloco }}</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <p class="overview-text body-large">{{ serie()!.overview }}</p>
                </mat-card-content>
            </mat-card>

            <app-serie-watch-providers [providers]="watchProviders()" />

            <app-serie-videos [videos]="videos()" />

            @if (!serie()!.data_complete) {
            <mat-card class="incomplete-data-card">
                <mat-card-content>
                    <div class="incomplete-data-content">
                        <mat-icon class="warning-icon">info</mat-icon>
                        <div class="incomplete-data-text">
                            <h4 class="incomplete-data-title">{{ 'serie_detail.incomplete_data_title' | transloco }}
                            </h4>
                            <p class="incomplete-data-message">{{ 'serie_detail.incomplete_data_message' | transloco }}
                            </p>
                        </div>
                    </div>
                </mat-card-content>
            </mat-card>
            }

            <app-serie-seasons [seasons]="seasons()" [isAuthenticated]="isAuthenticated()"
                [watchedSeasons]="watchedSeasons()" [watchedEpisodes]="watchedEpisodes()"
                [seasonLoadingStates]="seasonLoadingStates()" [episodeLoadingStates]="episodeLoadingStates()"
                (toggleSeasonWatched)="onToggleSeasonWatched($event)"
                (toggleEpisodeWatched)="onToggleEpisodeWatched($event)" />

            <mat-card class="details-card">
                <mat-card-header>
                    <mat-card-title class="headline-small">{{ 'serie_detail.details' | transloco }}</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">{{ 'serie_detail.first_air_date' | transloco }}:</span>
                            <span class="detail-value">{{ serie()!.first_air_date | date:'dd/MM/yyyy' }}</span>
                        </div>

                        @if (serie()!.last_air_date) {
                        <div class="detail-item">
                            <span class="detail-label">{{ 'serie_detail.last_air_date' | transloco }}:</span>
                            <span class="detail-value">{{ serie()!.last_air_date | date:'dd/MM/yyyy' }}</span>
                        </div>
                        }

                        <div class="detail-item">
                            <span class="detail-label">{{ 'serie_detail.popularity' | transloco }}:</span>
                            <span class="detail-value">{{ serie()!.popularity | number:'1.0-0' }}</span>
                        </div>

                        <div class="detail-item">
                            <span class="detail-label">{{ 'serie_detail.tmdb_id' | transloco }}:</span>
                            <span class="detail-value">{{ serie()!.tmdb_id }}</span>
                        </div>
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>
    }
</div>