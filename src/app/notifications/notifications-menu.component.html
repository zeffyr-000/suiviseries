<button mat-icon-button [matMenuTriggerFor]="notificationsMenu" [matBadge]="displayedUnreadCount()"
    [matBadgeHidden]="displayedUnreadCount() === 0" matBadgeColor="warn" matBadgeSize="medium">
    <mat-icon>notifications</mat-icon>
</button>

<mat-menu #notificationsMenu="matMenu" class="notifications-menu">
    @if (userNotificationService.notifications().length === 0) {
    <div class="no-notifications">
        <mat-icon>notifications_none</mat-icon>
        <p>{{ 'notification.no_notifications' | transloco }}</p>
    </div>
    } @else {
    @for (notification of userNotificationService.notifications(); track notification.user_notification_id) {
    <div class="notification-item" [class.unread]="notification.status === 'unread'">
        <button mat-menu-item class="notification-main" [class.new-season]="notification.type === 'new_season'"
            [class.new-episodes]="notification.type === 'new_episodes'"
            [class.status-update]="notification.type === 'status_canceled' || notification.type === 'status_ended'"
            (click)="onNotificationClick(notification)">
            <div class="notification-content">
                @if (notification.serie_poster) {
                <img [src]="userNotificationService.getTmdbPosterUrl(notification.serie_poster, 'w200')"
                    [alt]="notification.serie_name" class="notification-poster" />
                } @else {
                <div class="notification-icon-fallback">
                    <mat-icon>tv</mat-icon>
                </div>
                }
                <div class="notification-text">
                    <div class="notification-title">{{ notification.serie_name }}</div>
                    <div class="notification-message">{{ getNotificationMessage(notification) }}</div>
                    <div class="notification-date">{{ getFormattedDate(notification.created_at) }}</div>
                </div>
            </div>
        </button>
        <button mat-icon-button class="delete-button" (click)="onDeleteClick($event, notification)"
            [matTooltip]="'notification.delete' | transloco">
            <mat-icon>close</mat-icon>
        </button>
    </div>
    }
    }
</mat-menu>